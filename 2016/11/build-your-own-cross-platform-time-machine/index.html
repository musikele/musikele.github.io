<!DOCTYPE html>
<html>
  	<head>
  		<title>Michele Nasti - Full stack Developer with an eye for the web</title>
  		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
  		<meta name="description" content="Michele Nasti's personal blog'" />
  		<meta name="keywords" content="michele nasti" />
  		<!--<noscript>-->
  			<link rel="stylesheet" href="/css/skel.css" />
  			<link rel="stylesheet" href="/css/style.css" />
  			<link rel="stylesheet" href="/css/style-xlarge.css" />
  		<!--</noscript>-->
  		<!--[if lte IE 8]><link rel="stylesheet" href="/css/ie/v8.css" /><![endif]-->
  	</head>

	<body id="top">

		---
<header id="header">
	<a href="#" class="image avatar"><img src="/images/michele_nasti.jpg" alt="michele nasti volto" /></a>
	<h1><strong><a href="/">Michele Nasti</a></strong><br /> Full-stack developer <br> with an eye for the web<br>
	</h1>
<a href="/chi-sono-michele-nasti/">Chi sono</a> | 
<a href="/talks-conferences/">Talks &amp; Conferences</a> | 
<a href="/archives/page/">Archives</a>
</header>

<div id="main">
    <article>
        <header class="major">
            <h2 class="post-title">I was not satisfied with Time Machine so I wrote my own Backup System</h2>
                <p class="post-meta">Nov 5, 2016 â€¢ musikele</p>
        </header>

        <section>
            <p>When I bought my first Apple computer, 4 years ago, I had a big problem: my data would be backed up in an encrypted and proprietary format. This meant that I could not access to my data from a linux or windows computer. Iâ€™m not a fanboy, and I happily use every possible system on earth, so this is a huge issue for me. 4 years ago I decided to overcome this problem by starting the writing <strong>My Own Cross-Platform bash-based Time Machine</strong>!</p>

<h2 id="design-principles">Design principles</h2>

<ul>
  <li><strong>incremental backups -</strong> the first backup is a specular copy of your hard drive (well, in my case, of my home directory); the next backups will only transfer changed files.</li>
  <li><strong>Space-efficient</strong> - using <a href="https://en.wikipedia.org/wiki/Hard_link">hard links</a>, I can do as many backups I want (every hour, every dayâ€¦), non-changed files will be linked, not copied. No extra space is involved in this operation ğŸ˜‰</li>
  <li><strong>Snapshot view /File Versioning -Â </strong>every directory is named after a timestamp, like â€œ20161210-1359â€, so I know that this backup started at 13:59 the 10th of december of 2016.</li>
  <li><strong>Work with my private NAS</strong> -Â I bought a NAS System by Synology, so my data is safely stored in my house.</li>
  <li><strong>Work on different networks</strong>Â - When Iâ€™m far from home, I want to backup as well. This means I can backup from everywhere - as long thereâ€™s a free internet connection ğŸ˜‰</li>
  <li><strong>Possibility to be launched from every system</strong> - since it is a bash script, compatibility with Linux and Mac is assured. Some testing is required on Windows, but since Bash is now available on the platform, this should not be a big issue anymore.</li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li>You should have <strong>your own server / NAS</strong>, and you can <strong>access it via SSH</strong>. Â I have the cheapest Synology, but itâ€™s perfect for my data because it has two mirrored disks. You may try with online systems like S3,Â as long you have ssh access, you can use it.</li>
  <li>SSH access must be <a href="http://www.linuxproblem.org/art_9.html">configured to access without password</a>: to do this you must generate a pair of private/public keys and configure your server to accept your key. If you donâ€™t do this, the script will work but will ask the passwordÂ 4 times.</li>
</ul>

<h2 id="how-did-i-do-this">How did I do this?</h2>

<ul>
  <li>The magic is all by <strong><a href="http://rsync.samba.org">rsync</a>:</strong> this software is theÂ real engine that does the transfer, securely, efficiently.</li>
  <li>the script is programmend in <strong>bash,Â </strong>the worst programming language ever. There is no debug, no IDE support, the strangestÂ syntax, but it is also the software that powers the best available shell.</li>
</ul>

<h2 id="how-does-it-work">How does it work?</h2>

<ol>
  <li>The script will try to connect to the server and check ifÂ the backup folder exists.</li>
  <li>since every backup is stored in a directory named after date and time (example: <span class="lang:default decode:true crayon-inline">20161225-1400</span>), sort the directory and take the latest. This will be the base directory for calculating the difference.</li>
  <li>create a new directory named after the current date and time, and <strong>hard link</strong> the files that are not changed on your computer.</li>
  <li>copy only the modified files in the newly created directory.</li>
</ol>

<p>A hard link is a pointer to a file. If you create a hard link to a file, youÂ can access the same file from two locations on filesystem. If you delete a hard link the other will continue to work. When you delete all the hard links, the file is lost forever (and the OS willÂ markÂ that disk location as available for writing).</p>

<h2 id="what-will-you-do-now">What will you do now?</h2>

<ul>
  <li>The project is very simple and <strong>open source</strong>! Feel free to understand how does it work.</li>
  <li>Iâ€™m still developing a system to <strong>schedule backups</strong> on Mac. Next Iâ€™ll move on other platforms. This means that now you have to launch the script by hand with <span class="lang:default decode:true crayon-inline">./start.sh</span>Â .</li>
  <li>I also want to <strong>add some toast messages</strong> to say â€œhey! Iâ€™m going to backup everything. Click here if you donâ€™t want toâ€ (for example, when you are under a mobile connection).</li>
  <li>I also want to <strong>implement a solution that deletes unnecessary backups</strong>: it keeps 1 backup for every year, 1 backup for every month of the last 12 months, 1 backup per day for the last week, and one backup per hour for the last day.</li>
</ul>

<h2 id="where-is-the-source">WHERE IS THE SOURCE!!!</h2>

<p>I was forgetting the most important part. Youâ€™ll find the scriptÂ on <a href="https://github.com/musikele/backupscript">github</a>. Cheers!</p>

        </section>
        
        <footer>
            <div class="row">
            
            
                <article class="6u 12u(small) excerpt">
                    <header>
                        <h2><a href="//2016/11/orientdb/">OrientDBÂ </a></h2>
                    </header>
                    <section>
                        <p>Convenite con me che fare un DB Ã© la cosa piÃ¹ difficile che ci sia? Seconda solo a fare un sistema operativo, diciamo ğŸ˜‡</p>


                    </section>
                    <footer>
                        <ul class="actions">
                            <li><a href="//2016/11/orientdb/" class="button">Read More</a></li>
                        </ul>
                    </footer>
                </article>
            
            
            
            
                <article class="6u$ 12u(small) excerpt f-right">
                    <header>
                        <h2><a href="//2016/11/come-riconoscere-una-persona-che-fa-gioco-di-squadra/">Come riconoscere (e perchÃ© assumere) un buon &#8220;giocatore di squadra&#8221;Â </a></h2>
                    </header>
                    <section>
                        <p>Le qualitÃ  del buon giocatore di squadra sono:</p>

                    </section>
                    <footer>
                        <ul class="actions">
                            <li><a href="//2016/11/come-riconoscere-una-persona-che-fa-gioco-di-squadra/" class="button">Read More</a></li>
                        </ul>
                    </footer>
                </article>
            
            </div>
        </footer>

    </article>

</div>


        <!-- Footer -->
        ---
<footer id="footer">
	<ul class="icons">

		
		<li>
			<a href="https://github.com/musikele" class="icon fa-github">
				<span class="label">GitHub</span>
			</a>
		</li>
		 
		<li>
			<a href="https://twitter.com/micnasti" class="icon fa-twitter">
				<span class="label">Twitter</span>
			</a>
		</li>
		 
		<li>
			<a href="https://linkedin.com/in/michelenasti" class="icon fa-linkedin">
				<span class="label">LinkedIn</span>
			</a>
		</li>
		 
		<li>
			<a href="https://plus.google.com/MicheleNasti" class="icon fa-google-plus">
				<span class="label">Google+</span>
			</a>
		</li>
		 
		<li>
			<a href="https://www.facebook.com/musikele" class="icon fa-facebook">
				<span class="label">Facebook</span>
			</a>
		</li>
		  
	</ul>
	<ul class="copyright">
		<li>&copy; Michele Nasti</li>
		<li>Based on <a href="http://html5up.net/strata">STRATA</a> theme</li>
	</ul>
</footer>
<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
  		<script src="/js/jquery.min.js"></script>
  		<script src="/js/jquery.poptrox.min.js"></script>
  		<script src="/js/skel.min.js"></script>
  		<script src="/js/init.js"></script>
	</body>
</html>
